<div class="my-reservations-page">
  <div class="container py-4">
    <!-- Header -->
    <div class="page-header">
      <h1 class="page-title">
        <i class="bi bi-calendar2-check"></i>
        حجوزاتي
      </h1>
      <p class="page-description">جميع الحجوزات التي قمت بها</p>
    </div>

    <!-- Loading State -->
    @if (loading) {
      <div class="loading-container">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">جاري التحميل...</span>
        </div>
      </div>
    }

    <!-- Reservations Grid -->
    @if (!loading) {
      @if (reservations.length > 0) {
        <div class="reservations-grid">
          @for (reservation of reservations; track reservation.id) {
            <div class="reservation-card">
              <!-- Card Header -->
              <div class="card-header">
                <div class="reservation-id">
                  <i class="bi bi-hash"></i>
                  <span>حجز رقم {{ reservation.id }}</span>
                </div>
                <span class="status-badge" [ngClass]="getPaymentStatusClass(reservation.paymentStatus)">
                  {{ getPaymentStatusText(reservation.paymentStatus) }}
                </span>
              </div>

              <!-- Card Body -->
              <div class="card-body">
                <!-- Listing Info -->
                <div class="listing-info" (click)="viewListing(reservation.listingId)">
                  <h3 class="listing-title">{{ reservation.listingTitle }}</h3>
                  <div class="listing-location">
                    <i class="bi bi-geo-alt-fill"></i>
                    <span>{{ reservation.city }}</span>
                  </div>
                </div>

                <!-- Reservation Details Grid -->
                <div class="info-grid">
                  <div class="info-item">
                    <i class="bi bi-calendar-check mt-2"></i>
                    <div>
                      <span class="label">تاريخ البدء</span>
                      <span class="value">{{ reservation.startDate | date: 'dd/MM/yyyy' }}</span>
                    </div>
                  </div>

                  <div class="info-item">
                    <i class="bi bi-hourglass-split mt-2"></i>
                    <div>
                      <span class="label">المدة</span>
                      <span class="value">{{ reservation.durationInDays }} يوم</span>
                    </div>
                  </div>

                  <div class="info-item">
                    <i class="bi bi-calendar-x mt-2"></i>
                    <div>
                      <span class="label">تاريخ الانتهاء</span>
                      <span class="value">{{ getEndDate(reservation.startDate, reservation.durationInDays) | date: 'dd/MM/yyyy' }}</span>
                    </div>
                  </div>

                  <div class="info-item">
                    <i class="fa-solid fa-bed mt-2"></i>
                    <div>
                      <span class="label">عدد الأسرّة</span>
                      <span class="value">{{ reservation.beds.length }}</span>
                    </div>
                  </div>
                </div>

                <!-- Beds List -->
                <div class="beds-section">
                  <span class="beds-label">
                    <i class="bi bi-list-ul"></i>
                    الأسرّة المحجوزة:
                  </span>
                  <div class="bed-chips">
                    @for (bed of reservation.beds; track bed.bedId) {
                      <span class="bed-chip">
                        <i class="bi bi-hospital-bed"></i>
                        غرفة {{ bed.roomNumber }} • سرير {{ bed.bedNumber }}
                      </span>
                    }
                  </div>
                </div>

                <!-- Pricing Section -->
                <div class="pricing-section">
                  <div class="price-row">
                    <span class="price-label">المبلغ الإجمالي:</span>
                    <span class="price-value">{{ reservation.totalPrice }} ج.م</span>
                  </div>
                  @if (reservation.depositAmount) {
                    <div class="price-row">
                      <span class="price-label">العربون المدفوع:</span>
                      <span class="deposit-value">{{ reservation.depositAmount }} ج.م</span>
                    </div>
                  }
                </div>

                <!-- Dates Info -->
                <div class="dates-info">
                  <div class="date-badge">
                    <i class="bi bi-clock-history"></i>
                    تم الحجز: {{ reservation.createdAt | date: 'dd/MM/yyyy HH:mm' }}
                  </div>
                  @if (reservation.paidAt) {
                    <div class="date-badge paid">
                      <i class="bi bi-check-circle-fill"></i>
                      تم الدفع: {{ reservation.paidAt | date: 'dd/MM/yyyy HH:mm' }}
                    </div>
                  } 
                  @if(isPending(reservation.paymentStatus)) {
                    <div class="date-badge not-paid">
                      <i class="bi bi-x-circle-fill"></i>
                      لم يتم الدفع بعد. اكمل العملية الان!
                    </div>
                  }
                </div>
              </div>

              <!-- Card Footer -->
              <div class="card-footer">
                <button class="btn-view-listing" (click)="viewListing(reservation.listingId)">
                  <i class="bi bi-eye"></i>
                  عرض الإعلان
                </button>

                @if (isPending(reservation.paymentStatus)) {
                  <button class="btn-pay" (click)="completePayment(reservation)">
                    <i class="bi bi-credit-card-fill"></i>
                    إتمام الدفع
                  </button>
                }
              </div>
            </div>
          }
        </div>
      } @else {
        <div class="empty-state">
          <div class="empty-icon">
            <i class="bi bi-calendar-x"></i>
          </div>
          <h3>لا توجد حجوزات</h3>
          <p>لم تقم بأي حجوزات بعد. ابدأ البحث عن سكن مثالي!</p>
          <button class="btn-search" (click)="navigateToSearch()">
            <i class="bi bi-search"></i>
            البحث عن سكن
          </button>
        </div>
      }
    }
  </div>
</div>
