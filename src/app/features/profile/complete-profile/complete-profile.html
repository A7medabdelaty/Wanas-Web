<div class="profile-form-container">
  <div class="header-container">
    <div class="header-text">
      <h2 class="form-title">إكمال الملف الشخصي</h2>
      <p class="form-description">أضف معلوماتك الأساسية لبناء ملفك الشخصي</p>
    </div>

    <div
      class="upload-container"
      (drop)="onFileDrop($event)"
      (dragover)="onDragOver($event)"
    >
      <label
        for="file-upload"
        class="upload-circle"
        [style.background-image]="previewUrl() ? 'url(' + previewUrl() + ')' : null"
        [class.has-image]="!!previewUrl()"
      >
        @if (!previewUrl()) {
          <i class="fa-solid fa-camera"></i>
        }
      </label>
      <input
        type="file"
        id="file-upload"
        accept="image/*"
        (change)="onFileSelected($event)"
        class="file-input"
      />
      
      @if (!previewUrl()) {
        <p class="upload-label-text">أضف صورة</p>
      } @else {
        <button type="button" class="remove-text-btn" (click)="removeFile()">
          إزالة الصورة
        </button>
      }
    </div>
  </div>

  <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="profile-form">
    <!-- Age Input -->
    <div class="form-group">
      <label for="age" class="form-label">العمر *</label>
      <input
        type="number"
        id="age"
        formControlName="age"
        class="form-control"
        placeholder="أدخل عمرك"
        [class.invalid]="profileForm.get('age')?.invalid && profileForm.get('age')?.touched"
      />
      @if (profileForm.get('age')?.invalid && profileForm.get('age')?.touched) {
        <div class="error-message">
          @if (profileForm.get('age')?.errors?.['required']) {
            <span>العمر مطلوب</span>
          }
          @if (profileForm.get('age')?.errors?.['min']) {
            <span>العمر يجب أن يكون 18 سنة على الأقل</span>
          }
          @if (profileForm.get('age')?.errors?.['max']) {
            <span>العمر يجب أن يكون 100 سنة كحد أقصى</span>
          }
        </div>
      }
    </div>

    <!-- Bio Textarea -->
    <div class="form-group">
      <label for="bio" class="form-label">
        نبذة عنك *
        <span class="char-count">{{ getBioCharCount() }}/500</span>
      </label>
      <input
        id="bio"
        formControlName="bio"
        class="form-control"
        placeholder="اكتب نبذة مختصرة عنك..."
        [class.invalid]="profileForm.get('bio')?.invalid && profileForm.get('bio')?.touched"
      />
      @if (profileForm.get('bio')?.invalid && profileForm.get('bio')?.touched) {
        <div class="error-message">
          @if (profileForm.get('bio')?.errors?.['required']) {
            <span>النبذة مطلوبة</span>
          }
          @if (profileForm.get('bio')?.errors?.['minlength']) {
            <span>النبذة يجب أن تكون 10 أحرف على الأقل</span>
          }
          @if (profileForm.get('bio')?.errors?.['maxlength']) {
            <span>النبذة يجب أن لا تتجاوز 500 حرف</span>
          }
        </div>
      }
    </div>



    <!-- Error Message -->
    @if (errorMessage()) {
      <div class="alert alert-error">
        {{ errorMessage() }}
      </div>
    }

    <!-- Submit Button -->
    <button
      type="submit"
      class="btn btn-primary btn-block"
      [disabled]="isLoading()"
    >
      @if (isLoading()) {
        <span class="spinner"></span>
        <span>جاري الحفظ...</span>
      } @else {
        <span>التالي</span>
      }
    </button>
  </form>
</div>
