<div class="review-container">
  <div class="header">
    <h2>ูุฑุงุฌุนุฉ ุงูุฅุนูุงู</h2>
    <a routerLink="/adminDashboard/listings/pending" class="back-link">
      โ ุนูุฏุฉ ูููุงุฆูุฉ
    </a>
  </div>

  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
  </div>

  <div *ngIf="!loading && listing" class="content">

    <!-- Left Column -->
    <div>

      <!-- Images -->
      <div class="image-card">
        <div class="main-image">
          <img [src]="getListingImage(listing)">
        </div>
        <div *ngIf="listing.listingPhotos && listing.listingPhotos.length > 0" class="thumbnails">
          <img *ngFor="let photo of listing.listingPhotos" [src]="photo.url || photo" class="thumbnail">
        </div>
      </div>

      <!-- Details Card -->
      <div class="details-card">
        <h3>{{ listing.title }}</h3>
        <p class="location">
          ๐ {{ listing.city }} - {{ listing.address }}
        </p>

        <!-- Price Box -->
        <div class="price-box">
          <div class="price-row">
            <div class="price-main">
              <span class="price-amount">{{ listing.monthlyPrice }}</span>
              <span class="price-currency"> ุฌ.ู / ุดูุฑ</span>
            </div>
            <div class="stats">
              <div class="stat-item">
                <div class="stat-icon">๐</div>
                <div class="stat-value">{{ listing.areaInSqMeters }} ูยฒ</div>
              </div>
              <div class="stat-item">
                <div class="stat-icon">๐ช</div>
                <div class="stat-value">{{ listing.totalRooms }} ุบุฑู</div>
              </div>
              <div class="stat-item">
                <div class="stat-icon">๐ข</div>
                <div class="stat-value">ุงูุทุงุจู {{ listing.floor }}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Description -->
        <div class="section">
          <h5>๐ ุงููุตู</h5>
          <p class="description">{{ listing.description }}</p>
        </div>

        <!-- Features -->
        <div class="section">
          <h5>โญ ุงููููุฒุงุช</h5>
          <div class="features-grid">
            <div class="feature-item" [ngClass]="listing.hasElevator ? 'feature-active' : 'feature-inactive'">
              <div class="feature-icon">๐</div>
              <div class="feature-label">ูุตุนุฏ</div>
            </div>
            <div class="feature-item" [ngClass]="listing.hasKitchen ? 'feature-active' : 'feature-inactive'">
              <div class="feature-icon">๐ณ</div>
              <div class="feature-label">ูุทุจุฎ</div>
            </div>
            <div class="feature-item" [ngClass]="listing.hasInternet ? 'feature-active' : 'feature-inactive'">
              <div class="feature-icon">๐ก</div>
              <div class="feature-label">ุฅูุชุฑูุช</div>
            </div>
            <div class="feature-item" [ngClass]="listing.hasAirConditioner ? 'feature-active' : 'feature-inactive'">
              <div class="feature-icon">โ๏ธ</div>
              <div class="feature-label">ุชูููู</div>
            </div>
          </div>
        </div>

        <!-- Room Details -->
        <div class="section">
          <h5>๐ ุชูุงุตูู ุงูุบุฑู</h5>
          <div class="rooms-grid">
            <div class="room-box">
              <div class="room-label">ุฅุฌูุงูู ุงูุบุฑู</div>
              <div class="room-value">{{ listing.totalRooms }}</div>
            </div>
            <div class="room-box">
              <div class="room-label">ุงูุบุฑู ุงููุชุงุญุฉ</div>
              <div class="room-value room-value-available">{{ listing.availableRooms }}</div>
            </div>
            <div class="room-box">
              <div class="room-label">ุนุฏุฏ ุงูุญูุงูุงุช</div>
              <div class="room-value">{{ listing.totalBathrooms }}</div>
            </div>
          </div>
        </div>

        <!-- Date -->
        <div class="date-section">
          <small>๐ ุชุงุฑูุฎ ุงูุฅุถุงูุฉ: {{ listing.createdAt | date:'dd/MM/yyyy' }}</small>
        </div>
      </div>
    </div>

    <!-- Right Column - Actions -->
    <div>
      <!-- Status Card -->
      <div class="status-card">
        <h5>ุญุงูุฉ ุงูุฅุนูุงู</h5>
        <div>
          <span [ngClass]="getStatusBadgeClass(listing.moderationStatus)" class="status-badge">
            {{ getStatusLabel(listing.moderationStatus) }}
          </span>
        </div>

        <div *ngIf="listing.isFlagged" class="flag-alert">
          <strong>โ๏ธ ุชู ุงูุฅุจูุงุบ ุนูู</strong>
          <p>{{ listing.flagReason }}</p>
        </div>

        <div class="actions">
          <button (click)="approveListing()" class="btn-action btn-approve">
            <i class="bi bi-check-lg"></i>
            <span>ููุงููุฉ ููุดุฑ</span>
          </button>
          <button (click)="showRejectModal = true" class="btn-action btn-reject">
            <i class="bi bi-x-lg"></i>
            <span>ุฑูุถ ุงูุฅุนูุงู</span>
          </button>
          <button (click)="showFlagModal = true" class="btn-action btn-flag">
            <i class="bi bi-flag-fill"></i>
            <span>{{ listing.isFlagged ? 'ุชุญุฏูุซ ุงูุจูุงุบ' : 'ุฅุจูุงุบ' }}</span>
          </button>
        </div>
      </div>

      <!-- Owner Info -->
      <div *ngIf="listing.owner" class="owner-card">
        <h5>ูุนูููุงุช ุงููุงูู</h5>
        <div class="owner-header">
          <img [src]="listing.owner.photoUrl || '/assets/placeholder-user.jpg'" class="owner-avatar">
          <div>
            <div class="owner-name">{{ listing.owner.fullName }}</div>
            <div class="owner-email">{{ listing.owner.email }}</div>
          </div>
        </div>
        <div class="owner-details">
          <div class="owner-detail-item">
            ๐ {{ listing.owner.phone || 'ุบูุฑ ูุชููุฑ' }}
          </div>
          <div>
            ๐ {{ listing.owner.city || 'ุบูุฑ ูุชููุฑ' }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modals -->
<div *ngIf="showRejectModal" class="modal-overlay">
  <div class="modal-dialog">
    <div class="modal-header modal-header-danger">
      <h5>ุฑูุถ ุงูุฅุนูุงู</h5>
    </div>
    <div class="modal-body">
      <p>ูุฑุฌู ุฐูุฑ ุณุจุจ ุงูุฑูุถ:</p>
      <textarea [(ngModel)]="rejectReason" placeholder="ุณุจุจ ุงูุฑูุถ..." rows="4" dir="rtl"></textarea>
    </div>
    <div class="modal-footer">
      <button (click)="showRejectModal = false" class="btn-modal btn-cancel">ุฅูุบุงุก</button>
      <button (click)="rejectListing()" [disabled]="!rejectReason" class="btn-modal btn-confirm-danger">
        ุชุฃููุฏ ุงูุฑูุถ
      </button>
    </div>
  </div>
</div>

<div *ngIf="showFlagModal" class="modal-overlay">
  <div class="modal-dialog">
    <div class="modal-header modal-header-warning">
      <h5>ุฅุจูุงุบ ุนู ูุดููุฉ</h5>
    </div>
    <div class="modal-body">
      <textarea [(ngModel)]="flagReason" placeholder="ุณุจุจ ุงูุฅุจูุงุบ..."></textarea>
    </div>
    <div class="modal-footer">
      <button (click)="showFlagModal = false" class="btn-modal btn-cancel">ุฅูุบุงุก</button>
      <button (click)="flagListing()" [disabled]="!flagReason" class="btn-modal btn-confirm-warning">
        ุชุฃููุฏ
      </button>
    </div>
  </div>
</div>