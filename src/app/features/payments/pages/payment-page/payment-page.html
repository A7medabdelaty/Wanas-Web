@if(!isVerified) {
  <div class="alert alert-warning text-center mb-4" role="alert" dir="rtl">
    <i class="fas fa-exclamation-triangle me-2"></i>
    حسابك غير موثق. يرجى توثيق حسابك للوصول إلى جميع الميزات.
    <a [routerLink]="'/verification/upload'" class="btn btn-sm btn-primary ms-3">توثيق الحساب</a>
  </div>
}
@else {



<div class="payment-page">
  <div class="container py-4">
    @if (bookingSelection && listing) {
      <!-- Header -->
      <div class="payment-header">
        <button class="btn-back" (click)="cancel()">
          <i class="bi bi-arrow-right"></i>
        </button>
        <h1 class="page-title mb-4"><i class="fa-regular fa-circle-check m-2"></i>تأكيد الدفع</h1>
      </div>
<!-- Mock Payment Form -->
<div class="payment-card">

  <h2 class="section-title"> <i class="fa-solid fa-credit-card m-2"></i>بيانات الدفع </h2>

  <div class="form-row">
     <div class="form-group col-md-6">
    <label>رقم البطاقة</label>
    <input class="form-control" 
           type="text" 
           placeholder="0000 0000 0000 0000"
           [(ngModel)]="cardNumber"
           maxlength="19"
           (blur)="validateCardNumber()"
           (input)="onCardNumberInput($event)">
    @if (errors['cardNumber']) {
      <div class="invalid-feedback d-block">
        {{ errors['cardNumber'] }}
      </div>
    }
  </div>

  <div class="form-group col-md-6">
    <label>اسم صاحب البطاقة</label>
    <input class="form-control" 
           type="text" 
           placeholder="Ahmed Ali"
           maxlength="50"
           [(ngModel)]="cardholder"
           (blur)="validateName()"
           (input)="onNameInput($event)">
    @if (errors['cardholder']) {
      <div class="invalid-feedback d-block">
        {{ errors['cardholder'] }}
      </div>
    }
  </div>
  </div>

  <div class="form-row">
    <div class="form-group col-md-6">
      <label>تاريخ الانتهاء (MM/YY)</label>
      <input class="form-control" 
             type="text" 
             placeholder="MM/YY"
             [(ngModel)]="expiry"
             maxlength="5"
             (blur)="validateDate()"
             (input)="onDateInput($event)">
      @if (errors['expiry']) {
        <div class="invalid-feedback d-block">
          {{ errors['expiry'] }}
        </div>
      }
    </div>
    <div class="form-group col-md-6">
      <label>CVV</label>
      <input class="form-control" 
             type="text" 
             placeholder="123"
             [(ngModel)]="cvv"
             maxlength="3"
             (blur)="validateCVV()"
             (input)="onCvvInput($event)">
      @if (errors['cvv']) {
        <div class="invalid-feedback d-block">
          {{ errors['cvv'] }}
        </div>
      }
    </div>
  </div>

</div>


      <!-- Payment Card -->
      <div class="payment-card card-block">
        <!-- Listing Info -->
        <div class="listing-info">
          <h2 class="section-title"><i class="fa-solid fa-circle-info m-2"></i>معلومات الإعلان </h2>
          <div class="info-row">
            <span class="label">العنوان:</span>
            <span class="value">{{ listing.title }}</span>
          </div>
          <div class="info-row">
            <span class="label">الموقع:</span>
            <span class="value">{{ listing.city }} - {{ listing.address }}</span>
          </div>
        </div>

        <div class="divider"></div>

        <!-- Reservation Dates -->
        <div class="reservation-dates">
          <h2 class="section-title-2 mt-4"> <i class="fa-solid fa-calendar m-2"></i>تفاصيل الحجز</h2>
          <div class="dates-grid">
            <div class="date-card">
              <i class="bi bi-calendar-check"></i>
              <div class="date-info">
                <span class="date-label">تاريخ الوصول</span>
                <span class="date-value"> {{ bookingSelection.checkInDate | date:'fullDate':'':'ar-EG' }}</span>
              </div>
            </div>
            <div class="date-card">
              <i class="bi bi-calendar-x"></i>
              <div class="date-info">
                <span class="date-label">تاريخ المغادرة</span>
                <span class="date-value"> {{ bookingSelection.checkOutDate | date:'fullDate':'':'ar-EG' }}</span>
              </div>
            </div>
          </div>
          <div class="duration-badge">
            <i class="bi bi-clock-history"></i> 
            <span> مدة الحجز: {{ bookingSelection.duration }} يوم</span>
          </div>
        </div>

        <div class="divider"></div>

        <!-- Booking Summary -->
        <div class="booking-summary card-block">
          <h2 class="section-title"><i class="fa-solid fa-clipboard-list m-2"></i>ملخص الحجز</h2>
          @for (item of bookingSelection.breakdown; track $index) {
            <div class="summary-row">
              <div class="item-info">
                <i class="bi m-1" [class.bi-door-closed]="item.type === 'room'" 
                   [class.bi-hospital-bed]="item.type === 'bed'"
                   [class.bi-house-check]="item.type === 'full'"></i>
                <span class="item-name">{{ item.name }}</span>
                @if (item.quantity > 1) {
                  <span class="item-quantity">× {{ item.quantity }}</span>
                }
              </div>
              <div class="item-pricing">
                @if (item.quantity > 1) {
                  <span class="unit-price">{{ item.quantity }} × {{ item.unitPrice }} ج.م</span>
                  
                }
                
              </div>
            </div>
          }
          <div class="total-row">
            <span class="total-label">المبلغ الإجمالي: </span>
            <span class="total-amount">{{ bookingSelection.totalAmount }} ج.م</span>
          </div>
          <div class="total-row">
            <span class="total-label">المبلغ المطلوب: </span>
            <span class="total-amount">{{ bookingSelection.totalAmount * 0.2 }} ج.م</span>
          </div>
          <p class="payment-note mt-3">
            <i class="bi bi-info-circle"></i>
            سيتم دفع باقي المبلغ عند الوصول إلى مكان الإقامة
          </p>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons card-block">
          <button 
            class="btn btn-cancel" 
            (click)="cancel()"
            [disabled]="processing">
            رجوع
          </button>
          <button 
            class="btn btn-pay" 
            (click)="processPayment()"
            [disabled]="processing">
            @if (processing) {
              <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
              جاري المعالجة...
            } @else {
              <i class="bi bi-credit-card me-2"></i>
              تأكيد الدفع
            }
          </button>
        </div>

        <!-- Security Badge -->
        <div class="security-badge">
          <i class="bi bi-shield-check m-1"></i>
          <span>جميع المعاملات آمنة ومشفرة</span>
        </div>
      </div>
    } @else {
      <div class="loading-container">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">جاري التحميل...</span>
        </div>
      </div>
    }
  </div>
</div>
}