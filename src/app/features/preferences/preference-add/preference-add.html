<div class="preferences-form-container">
  <h2 class="form-title">إضافة التفضيلات</h2>
  <p class="form-description">ساعدنا في إيجاد أفضل شريك سكن لك</p>

  <form [formGroup]="preferencesForm" (ngSubmit)="onSubmit()" class="preferences-form">
    <!-- Location Section -->
    <div class="form-section">
      <h3 class="section-title"><i class="fa-solid fa-location-dot"></i> الموقع</h3>
      <div class="form-row">
        <div class="form-group">
          <label for="city" class="form-label">المدينة *</label>
          <div class="custom-select-container" [class.open]="openDropdown === 'city'">
            <div class="custom-select-trigger" (click)="toggleDropdown('city')" [class.invalid]="preferencesForm.get('city')?.invalid && preferencesForm.get('city')?.touched">
              <span>{{ preferencesForm.get('city')?.value || 'اختر المدينة' }}</span>
              <div class="arrow">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
            </div>
            <div class="custom-options" *ngIf="openDropdown === 'city'">
              <div class="custom-option" 
                   *ngFor="let city of cities" 
                   [class.selected]="preferencesForm.get('city')?.value === city" 
                   (click)="selectOption('city', city)">
                {{ city }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Demographics Section -->
    <div class="form-section">
      <h3 class="section-title"><i class="fa-solid fa-person"></i> تفضيلاتك الخاصة</h3>
      <div class="form-row">
        <div class="form-group">
          <label for="minimumAge" class="form-label">الحد الأدنى للعمر *</label>
          <input
            type="number"
            id="minimumAge"
            formControlName="minimumAge"
            class="form-control"
            placeholder="18"
          />
        </div>
        <div class="form-group">
          <label for="maximumAge" class="form-label">الحد الأقصى للعمر *</label>
          <input
            type="number"
            id="maximumAge"
            formControlName="maximumAge"
            class="form-control"
            placeholder="50"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="gender" class="form-label">الجنس المفضل *</label>
          <div class="custom-select-container" [class.open]="openDropdown === 'gender'">
            <div class="custom-select-trigger" (click)="toggleDropdown('gender')">
              <span>{{ getLabel('gender', genderOptions) }}</span>
              <div class="arrow">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
            </div>
            <div class="custom-options" *ngIf="openDropdown === 'gender'">
              <div class="custom-option" 
                   *ngFor="let option of genderOptions"
                   [class.selected]="preferencesForm.get('gender')?.value === option.value" 
                   (click)="selectOption('gender', option.value)">
                {{ option.label }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Budget Section -->
    <div class="form-section">
      <h3 class="section-title"><i class="fa-solid fa-sack-dollar"></i> الميزانية</h3>
      <div class="form-row">
        <div class="form-group">
          <label for="minimumBudget" class="form-label">الحد الأدنى للميزانية *</label>
          <input
            type="number"
            id="minimumBudget"
            formControlName="minimumBudget"
            class="form-control"
            placeholder="0"
          />
        </div>
        <div class="form-group">
          <label for="maximumBudget" class="form-label">الحد الأقصى للميزانية *</label>
          <input
            type="number"
            id="maximumBudget"
            formControlName="maximumBudget"
            class="form-control"
            placeholder="10000"
          />
        </div>
      </div>
    </div>

    <!-- Lifestyle Section -->
    <div class="form-section">
      <h3 class="section-title"><i class="fa-solid fa-house"></i> نمط الحياة</h3>
      <div class="form-row">
        <div class="form-group">
          <label for="children" class="form-label">وجود أطفال *</label>
          <div class="custom-select-container" [class.open]="openDropdown === 'children'">
            <div class="custom-select-trigger" (click)="toggleDropdown('children')">
              <span>{{ getLabel('children', yesNoOptions) }}</span>
              <div class="arrow">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
            </div>
            <div class="custom-options" *ngIf="openDropdown === 'children'">
              <div class="custom-option" 
                   *ngFor="let option of yesNoOptions"
                   [class.selected]="preferencesForm.get('children')?.value === option.value" 
                   (click)="selectOption('children', option.value)">
                {{ option.label }}
              </div>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="pets" class="form-label">وجود حيوانات أليفة *</label>
          <div class="custom-select-container" [class.open]="openDropdown === 'pets'">
            <div class="custom-select-trigger" (click)="toggleDropdown('pets')">
              <span>{{ getLabel('pets', yesNoOptions) }}</span>
              <div class="arrow">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
            </div>
            <div class="custom-options" *ngIf="openDropdown === 'pets'">
              <div class="custom-option" 
                   *ngFor="let option of yesNoOptions"
                   [class.selected]="preferencesForm.get('pets')?.value === option.value" 
                   (click)="selectOption('pets', option.value)">
                {{ option.label }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="smoking" class="form-label">التدخين *</label>
          <div class="custom-select-container" [class.open]="openDropdown === 'smoking'">
            <div class="custom-select-trigger" (click)="toggleDropdown('smoking')">
              <span>{{ getLabel('smoking', allowedOptions) }}</span>
              <div class="arrow">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
            </div>
            <div class="custom-options" *ngIf="openDropdown === 'smoking'">
              <div class="custom-option" 
                   *ngFor="let option of allowedOptions"
                   [class.selected]="preferencesForm.get('smoking')?.value === option.value" 
                   (click)="selectOption('smoking', option.value)">
                {{ option.label }}
              </div>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="visits" class="form-label">الزيارات *</label>
          <div class="custom-select-container" [class.open]="openDropdown === 'visits'">
            <div class="custom-select-trigger" (click)="toggleDropdown('visits')">
              <span>{{ getLabel('visits', allowedOptions) }}</span>
              <div class="arrow">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
            </div>
            <div class="custom-options" *ngIf="openDropdown === 'visits'">
              <div class="custom-option" 
                   *ngFor="let option of allowedOptions"
                   [class.selected]="preferencesForm.get('visits')?.value === option.value" 
                   (click)="selectOption('visits', option.value)">
                {{ option.label }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="overnightGuests" class="form-label">الضيوف ليلاً *</label>
          <div class="custom-select-container" [class.open]="openDropdown === 'overnightGuests'">
            <div class="custom-select-trigger" (click)="toggleDropdown('overnightGuests')">
              <span>{{ getLabel('overnightGuests', allowedOptions) }}</span>
              <div class="arrow">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
            </div>
            <div class="custom-options" *ngIf="openDropdown === 'overnightGuests'">
              <div class="custom-option" 
                   *ngFor="let option of allowedOptions"
                   [class.selected]="preferencesForm.get('overnightGuests')?.value === option.value" 
                   (click)="selectOption('overnightGuests', option.value)">
                {{ option.label }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Habits & Preferences Section -->
    <div class="form-section">
      <h3 class="section-title"><i class="fa-solid fa-gear"></i> العادات والتفضيلات</h3>
      <div class="form-row">
        <div class="form-group">
          <label for="sleepSchedule" class="form-label">جدول النوم *</label>
          <div class="custom-select-container" [class.open]="openDropdown === 'sleepSchedule'">
            <div class="custom-select-trigger" (click)="toggleDropdown('sleepSchedule')">
              <span>{{ getLabel('sleepSchedule', sleepOptions) }}</span>
              <div class="arrow">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
            </div>
            <div class="custom-options" *ngIf="openDropdown === 'sleepSchedule'">
              <div class="custom-option" 
                   *ngFor="let option of sleepOptions"
                   [class.selected]="preferencesForm.get('sleepSchedule')?.value === option.value" 
                   (click)="selectOption('sleepSchedule', option.value)">
                {{ option.label }}
              </div>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="socialLevel" class="form-label">المستوى الاجتماعي *</label>
          <div class="custom-select-container" [class.open]="openDropdown === 'socialLevel'">
            <div class="custom-select-trigger" (click)="toggleDropdown('socialLevel')">
              <span>{{ getLabel('socialLevel', socialOptions) }}</span>
              <div class="arrow">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
            </div>
            <div class="custom-options" *ngIf="openDropdown === 'socialLevel'">
              <div class="custom-option" 
                   *ngFor="let option of socialOptions"
                   [class.selected]="preferencesForm.get('socialLevel')?.value === option.value" 
                   (click)="selectOption('socialLevel', option.value)">
                {{ option.label }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="noiseToleranceLevel" class="form-label">تحمل الضوضاء *</label>
          <div class="custom-select-container" [class.open]="openDropdown === 'noiseToleranceLevel'">
            <div class="custom-select-trigger" (click)="toggleDropdown('noiseToleranceLevel')">
              <span>{{ getLabel('noiseToleranceLevel', noiseOptions) }}</span>
              <div class="arrow">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
            </div>
            <div class="custom-options" *ngIf="openDropdown === 'noiseToleranceLevel'">
              <div class="custom-option" 
                   *ngFor="let option of noiseOptions"
                   [class.selected]="preferencesForm.get('noiseToleranceLevel')?.value === option.value" 
                   (click)="selectOption('noiseToleranceLevel', option.value)">
                {{ option.label }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Job & Education Section -->
    <div class="form-section">
      <h3 class="section-title"><i class="fa-solid fa-briefcase"></i> العمل والتعليم</h3>
      <div class="form-row">
        <div class="form-group">
          <label for="job" class="form-label">الوظيفة *</label>
          <input
            type="text"
            id="job"
            formControlName="job"
            class="form-control"
            placeholder="مثال: مهندس برمجيات"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group checkbox-group">
          <label class="checkbox-label">
            <input
              type="checkbox"
              formControlName="isStudent"
              class="checkbox-input"
            />
            <span>أنا طالب</span>
          </label>
        </div>
      </div>

      @if (isStudent) {
        <div class="form-row student-fields">
          <div class="form-group">
            <label for="university" class="form-label">الجامعة *</label>
            <input
              type="text"
              id="university"
              formControlName="university"
              class="form-control"
              placeholder="مثال: جامعة القاهرة"
            />
          </div>
          <div class="form-group">
            <label for="major" class="form-label">التخصص *</label>
            <input
              type="text"
              id="major"
              formControlName="major"
              class="form-control"
              placeholder="مثال: علوم الحاسب"
            />
          </div>
        </div>
      }
    </div>

    <!-- Error Message -->
    @if (errorMessage()) {
      <div class="alert alert-error" style="white-space: pre-line;">
        {{ errorMessage() }}
      </div>
    }

    <!-- Submit Button -->
    <button
      type="submit"
      class="btn btn-primary btn-block"
      [disabled]="isLoading()"
    >
      @if (isLoading()) {
        <span class="spinner"></span>
        <span>جاري الحفظ...</span>
      } @else {
        <span>إنهاء</span>
      }
    </button>
  </form>
</div>
