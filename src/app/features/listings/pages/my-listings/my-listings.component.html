<div class="container mt-5 mb-5" dir="rtl">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-bold mb-0 text-dark">إعلاناتي</h3>
    <button class="btn rounded-pill px-4 shadow-sm add-listing-btn" routerLink="/listings/add" *ngIf="listings.length > 0">
      <i class="fa-solid fa-plus"></i> إضافة إعلان
    </button>
  </div>

  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <div *ngIf="!loading && listings.length === 0" class="text-center py-5 bg-light rounded-4">
    <i class="bi bi-house-slash display-4 text-muted mb-3"></i>
    <p class="lead text-muted mb-3">ليس لديك إعلانات حالياً</p>
    <a routerLink="/listings/add" class="btn rounded-pill px-4 add-listing-btn"> <i class="fa-solid fa-plus"></i> أضف إعلانك الأول</a>
  </div>

  <div *ngIf="!loading && listings.length > 0" class="row g-4">
    <div class="col-md-6 col-lg-4" *ngFor="let listing of listings">
      <div class="card h-100 border-0 shadow-sm rounded-4 overflow-hidden listing-card">
        <div class="position-relative">
          <img [src]="getListingImage(listing)" [alt]="listing.title" class="listing-image"
            onerror="this.src='https://placehold.co/600x400?text=No+Image'" />
          
          <!-- Price Badge -->
          <div class="position-absolute top-0 end-0 m-3">
            <span class="badge bg-white text-dark shadow-sm rounded-pill px-3 py-2">
              {{ listing.monthlyPrice | currency:'USD':'symbol':'1.0-0' }} / شهرياً
            </span>
          </div>

          <!-- Status Badge -->
          <div class="position-absolute top-0 start-0 m-3">
            <span [ngClass]="getStatusBadgeClass(listing.moderationStatus)" 
                  class="badge shadow-sm rounded-pill px-3 py-2 cursor-pointer"
                  (click)="showModerationDetails(listing)">
              {{ getStatusLabel(listing.moderationStatus) }}
              <span *ngIf="listing.isFlagged">⚠️</span>
            </span>
          </div>
        </div>

        <div class="card-body p-4">
          <h5 class="card-title fw-bold mb-2 text-truncate">{{ listing.title }}</h5>
          <div class="d-flex align-items-center text-muted mb-3 small">
            <i class="bi bi-geo-alt me-1 ms-1"></i> {{ listing.city }}
          </div>

          <div class="d-flex justify-content-between align-items-center mt-3 pt-3 border-top">
            <small class="text-muted">
              <i class="bi bi-clock me-1 ms-1"></i> {{ listing.createdAt | date:'mediumDate' }}
            </small>
            <button class="btn btn-sm btn-outline-primary rounded-pill px-3"
                    [routerLink]="['/listings', listing.id]">
              التفاصيل <i class="bi bi-arrow-left ms-1"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Moderation Details Modal -->
<div *ngIf="selectedListing" class="modal-overlay">
  <div class="modal-dialog">
    <h3>حالة الإعلان</h3>
    
    <div class="modal-section">
      <p>الحالة الحالية:</p>
      <span [ngClass]="getStatusBadgeClass(selectedListing.moderationStatus)" class="status-badge">
        {{ getStatusLabel(selectedListing.moderationStatus) }}
      </span>
    </div>

    <div *ngIf="selectedListing.moderationNote" class="modal-note">
      <p>ملاحظات المشرف:</p>
      <p>{{ selectedListing.moderationNote }}</p>
    </div>

    <div *ngIf="selectedListing.isFlagged" class="modal-flag">
      <p>تم الإبلاغ عن هذا الإعلان:</p>
      <p>{{ selectedListing.flagReason }}</p>
    </div>

    <div class="modal-footer">
      <button (click)="selectedListing = null" class="btn-close">
        إغلاق
      </button>
    </div>
  </div>
</div>
