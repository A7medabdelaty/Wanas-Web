<div class="listing-details-page">
  <div class="container py-4">
    @if (listing) {
      <!-- Listing Photos Slider -->
      <app-listing-photos [photos]="listing.listingPhotos"></app-listing-photos>

      <!-- Listing Details -->
      <app-listing-details-card [listing]="listing"></app-listing-details-card>
    } @else {
      <div class="loading-container">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">جاري التحميل...</span>
        </div>
      </div>
    }

    <!-- Host Details Section (only show if listing is NOT owned by current user) -->
    @if (!isOwner && listing) {
      @if (loadingHost) {
        <div class="loading-container text-center my-4">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">جاري تحميل معلومات المضيف...</span>
          </div>
          <p class="mt-2 text-muted">جاري تحميل معلومات المضيف...</p>
        </div>
      } @else if (host) {
        <app-host-details [host]="host" (sendMessage)="onCreateChat()"></app-host-details>
      }
    }

    @if (listing) {
      <app-comment-section [comments]="listing.comments" (addComment)="onAddComment()"></app-comment-section>
    }

    @if (!isOwner) {
      <!-- Reviews Section (only show if listing is NOT owned by current user) -->
      <app-reviews-section [reviews]="reviews" (addReview)="onAddReview()"></app-reviews-section>
    }

    @if (listing && isOwner) {
      <!-- Owner Actions (only show if listing IS owned by current user) -->
          <div class="owner-actions">
            <button class="btn btn-primary me-3" (click)="onUpdateListing()">
              <i class="bi bi-pencil-square me-2"></i>
              تعديل الإعلان
            </button>
            <button class="btn btn-danger" (click)="onDeleteListing()">
              <i class="bi bi-trash me-2"></i>
              حذف الإعلان
            </button>
          </div>
    }
  </div>

  <!-- Delete Confirmation Modal -->
  @if (showDeleteModal) {
    <div class="delete-modal-overlay" (click)="onBackdropClick($event)">
      <div class="delete-modal-content" (click)="$event.stopPropagation()">
        <div class="delete-modal-header">
          <h3 class="delete-modal-title">تأكيد الحذف</h3>
        </div>
        <div class="delete-modal-body">
          <p>هل أنت متأكد من حذف هذا الإعلان؟</p>
          <p class="delete-modal-warning">لا يمكن التراجع عن هذا الإجراء.</p>
        </div>
        <div class="delete-modal-footer">
          <button 
            class="btn btn-cancel" 
            (click)="closeDeleteModal()"
            [disabled]="isDeleting">
            إلغاء
          </button>
          <button 
            class="btn btn-confirm-delete" 
            (click)="confirmDelete()"
            [disabled]="isDeleting">
            @if (isDeleting) {
              <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
              جاري الحذف...
            } @else {
              <i class="bi bi-trash me-2"></i>
              حذف
            }
          </button>
        </div>
      </div>
    </div>
  }
</div>
