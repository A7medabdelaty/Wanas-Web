<div class="search-page-container">
  <!-- Sidebar Filters -->
  <aside class="filters-sidebar">
    <div class="filters-header">
      <h2>تصفية النتائج</h2>
      <button class="reset-btn" (click)="resetFilters()">إعادة تعيين</button>
    </div>

    <!-- Price Range -->
    <div class="filter-section">
      <h3>نطاق السعر</h3>
      <div class="price-slider">
        <input 
          type="range" 
          min="0" 
          max="50000" 
          step="100" 
          [(ngModel)]="filters.maxPrice" 
          (change)="applyFilters()"
        >
        <div class="price-labels">
          <span>{{ filters.minPrice }} ج.م</span>
          <span>{{ filters.maxPrice }} ج.م</span>
        </div>
      </div>
    </div>

    <!-- Rooms & Beds -->
    <div class="filter-section">
      <h3>الغرف والأسرّة</h3>
      <div class="counter-filter">
        <label>الحد الأدنى للغرف</label>
        <div class="counter-controls">
          <button (click)="filters.minRooms = (filters.minRooms || 0) - 1; applyFilters()" [disabled]="(filters.minRooms || 0) <= 0">-</button>
          <span>{{ filters.minRooms || 0 }}</span>
          <button (click)="filters.minRooms = (filters.minRooms || 0) + 1; applyFilters()">+</button>
        </div>
      </div>
      <div class="counter-filter">
        <label>الحد الأدنى للأسرّة</label>
        <div class="counter-controls">
          <button (click)="filters.minBeds = (filters.minBeds || 0) - 1; applyFilters()" [disabled]="(filters.minBeds || 0) <= 0">-</button>
          <span>{{ filters.minBeds || 0 }}</span>
          <button (click)="filters.minBeds = (filters.minBeds || 0) + 1; applyFilters()">+</button>
        </div>
      </div>
    </div>

    <!-- Amenities -->
    <div class="filter-section">
      <h3>المميزات</h3>
      <div class="checkbox-group">
        <label class="checkbox-item">
          <input type="checkbox" [(ngModel)]="filters.hasInternet" (change)="applyFilters()">
          <span>إنترنت (Wi-Fi)</span>
        </label>
        <label class="checkbox-item">
          <input type="checkbox" [(ngModel)]="filters.hasKitchen" (change)="applyFilters()">
          <span>مطبخ</span>
        </label>
        <label class="checkbox-item">
          <input type="checkbox" [(ngModel)]="filters.hasElevator" (change)="applyFilters()">
          <span>مصعد</span>
        </label>
        <label class="checkbox-item">
          <input type="checkbox" [(ngModel)]="filters.hasAirConditioner" (change)="applyFilters()">
          <span>تكييف</span>
        </label>
        <label class="checkbox-item">
          <input type="checkbox" [(ngModel)]="filters.isPetFriendly" (change)="applyFilters()">
          <span>يسمح بالحيوانات الأليفة</span>
        </label>
        <label class="checkbox-item">
          <input type="checkbox" [(ngModel)]="filters.isSmokingAllowed" (change)="applyFilters()">
          <span>يسمح بالتدخين</span>
        </label>
      </div>
    </div>
  </aside>

  <!-- Search Results -->
  <main class="results-content">
    <div class="results-header">
      <h1>{{ totalCount }} سكن متاح</h1>
      <div class="sort-controls">
        <div class="custom-select-container" [class.open]="openDropdown === 'sortBy'">
          <div class="custom-select-trigger" (click)="toggleDropdown('sortBy')">
            <span>{{ getSortLabel(filters.sortBy) }}</span>
            <div class="arrow">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </div>
          </div>
          <div class="custom-options" *ngIf="openDropdown === 'sortBy'">
            <div class="custom-option" [class.selected]="filters.sortBy === ''" (click)="selectSort('')">
              الأحدث
            </div>
            <div class="custom-option" [class.selected]="filters.sortBy === 'price_asc'" (click)="selectSort('price_asc')">
              السعر: الأقل أولاً
            </div>
            <div class="custom-option" [class.selected]="filters.sortBy === 'price_desc'" (click)="selectSort('price_desc')">
              السعر: الأعلى أولاً
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <p>جاري البحث...</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && listings.length === 0" class="empty-state">
      <div class="empty-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          <line x1="8" y1="8" x2="14" y2="14"></line>
          <line x1="14" y1="8" x2="8" y2="14"></line>
        </svg>
      </div>
      <h3>لا توجد نتائج تطابق بحثك</h3>
      <p>حاول تغيير كلمات البحث أو تخفيف الفلاتر للحصول على نتائج أكثر.</p>
      <button class="reset-btn-primary" (click)="resetFilters()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
        إعادة تعيين الفلاتر
      </button>
    </div>

    <!-- Listings Grid -->
    <div *ngIf="!loading && listings.length > 0" class="listings-grid">
      <div *ngFor="let listing of listings" class="listing-card">
        <div class="listing-image">
          <img [src]="listing.mainImageUrl || '/assets/placeholder-house.jpg'" [alt]="listing.title">
          <span class="match-badge" *ngIf="listing.matchPercentage">{{ listing.matchPercentage }}% تطابق</span>
        </div>
        <div class="listing-details">
          <div class="price-row">
            <span class="price">{{ listing.price }} ج.م<span>/شهر</span></span>
          </div>
          <h3 class="title">{{ listing.title }}</h3>
          <p class="location">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
            {{ listing.city }}
          </p>
          <div class="features-row">
            <span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3h18v18H3zM21 9H3M21 15H3M12 3v18"/></svg> {{ listing.numberOfRooms }} غرف</span>
            <span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 4v16M22 4v16M2 8h20M2 16h20"/></svg> {{ listing.numberOfBeds }} سرير</span>
          </div>
          <a [routerLink]="['/listings', listing.id]" class="view-btn">عرض التفاصيل</a>
        </div>
      </div>
    </div>
  </main>
</div>
