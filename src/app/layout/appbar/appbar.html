<nav class="appbar">
  <!-- Logo Section -->
  <a routerLink="/" class="logo">
    <img
      src="/src/assets/test-logo.png"
      alt="Wanas Logo"
      height="40"
      onerror="this.style.display='none'"
    />
    <span>ونس</span>
  </a>

  <!-- Mobile Toggle Button -->
  <button
    class="mobile-toggle"
    [class.active]="isMobileMenuOpen"
    (click)="toggleMobileMenu()"
    [attr.aria-expanded]="isMobileMenuOpen"
    [attr.aria-label]="isMobileMenuOpen ? 'إغلاق القائمة' : 'فتح القائمة'"
  >
    <span class="hamburger"></span>
  </button>

  <!-- Navigation Links -->
  <ul class="nav-links" [class.mobile-open]="isMobileMenuOpen">
    <li *ngFor="let item of filteredNavItems" class="nav-item">
      @if (item.link == '/') {
      <a
        [routerLink]="item.link"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: true }"
        (click)="isMobileMenuOpen = false"
      >
        {{ item.label }}
      </a>
      } @else {
      <a [routerLink]="item.link" routerLinkActive="active" (click)="isMobileMenuOpen = false">
        {{ item.label }}
      </a>
      }
    </li>

    <!-- Mobile-only User Actions -->
    <li class="nav-item mobile-only" *ngIf="isMobileMenuOpen">
      <button *ngIf="!isGuest" (click)="logout()" class="btn-logout btn-mobile">تسجيل خروج</button>
      <button *ngIf="isGuest" routerLink="/login" class="btn-login btn-mobile">تسجيل دخول</button>
    </li>
  </ul>

  <!-- Desktop User Actions -->
  <div class="user-actions desktop-only">
    <ng-container *ngIf="isGuest; else loggedInUser">
      <button routerLink="auth/login" class="btn-login">تسجيل دخول</button>
      <button routerLink="auth/register" class="btn-register">إنشاء حساب</button>
    </ng-container>

    <ng-template #loggedInUser>
      <div class="user-profile-dropdown">
        <div class="user-avatar" (click)="toggleDropdown()">
          <img *ngIf="userImage" [src]="userImage" alt="{{ userName }}" class="avatar-image" />
          <span *ngIf="!userImage" class="avatar-text">{{ userName.charAt(0) }}</span>
        </div>
        
        <div class="dropdown-menu" [class.show]="isDropdownOpen">
          <div class="dropdown-header">
            <div class="dropdown-avatar">
              <img *ngIf="userImage" [src]="userImage" alt="{{ userName }}" class="avatar-image" />
              <span *ngIf="!userImage" class="avatar-text">{{ userName.charAt(0) }}</span>
            </div>
            <div class="dropdown-user-info">
              <span class="dropdown-user-name">{{ userName }}</span>
            </div>
          </div>
          <div class="dropdown-divider"></div>
          <button (click)="navigateToProfile()" class="dropdown-item">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <span>الملف الشخصي</span>
          </button>
          <button (click)="logout()" class="dropdown-item logout">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
              <polyline points="16 17 21 12 16 7"></polyline>
              <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            <span>تسجيل خروج</span>
          </button>
        </div>
      </div>
    </ng-template>
  </div>
</nav>
