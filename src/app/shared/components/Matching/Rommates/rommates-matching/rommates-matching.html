<div class="container mt-5">

  <!-- Header Section -->
  <div class="d-flex align-items-center justify-content-between mb-4">
    <h3 class="fw-bold m-0 text-dark font-cairo">نتائج التطابق</h3>
    <!-- Hide badge while loading -->
    <span class="badge bg-primary bg-opacity-10 text-primary rounded-pill px-3" *ngIf="!isLoading && matches.length > 0">
      {{ matches.length }} نتائج
    </span>
  </div>

  <!-- 1. LOADING SKELETON (Shows while API is calling) -->
  <div class="row g-4" *ngIf="isLoading">
    <div class="col-md-6 col-lg-4" *ngFor="let i of [1,2,3]">
      <div class="card border-0 h-100 shadow-sm" aria-hidden="true">
        <div class="bg-secondary bg-opacity-10 placeholder-glow" style="height: 240px; width: 100%;"></div>
        <div class="card-body p-4">
          <h5 class="card-title placeholder-glow">
            <span class="placeholder col-6 rounded"></span>
          </h5>
          <p class="card-text placeholder-glow">
            <span class="placeholder col-4 rounded"></span>
          </p>
          <hr class="my-3 opacity-25">
          <div class="d-flex gap-2 placeholder-glow">
            <span class="placeholder col-3 rounded-pill py-3"></span>
            <span class="placeholder col-3 rounded-pill py-3"></span>
            <span class="placeholder col-3 rounded-pill py-3"></span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 2. ACTUAL CONTENT (Shows when data arrives) -->
  <div class="row g-4" *ngIf="!isLoading && matches.length > 0">
    <div class="col-md-6 col-lg-4" *ngFor="let m of matches">
      <div class="card match-card border-0 h-100 shadow-sm">

        <!-- Image Container with Overlay -->
        <div class="card-img-wrapper position-relative">
          
          <img
            [src]="m.photo ? m.photo : (m.gender == 'Male' || m.gender == 'male' ? defaultMaleImage : defaultFemaleImage)"
            (error)="handleImageError($event)"
            class="card-img-top match-img"
            alt="{{ m.fullName }}"
          />

          <!-- Floating Score Badge -->
          <div class="score-badge position-absolute top-0 end-0 m-3 shadow-sm"
               [ngClass]="'bg-' + getScoreColor(m.score)">
            <span class="h5 fw-bold m-0 text-white">{{ m.score }}%</span>
            <small class="d-block text-white-50" style="font-size: 0.65rem">تطابق</small>
          </div>

          <!-- Age Tag (Bottom Left) -->
          <div class="position-absolute bottom-0 start-0 m-3">
            <span class="badge bg-light text-dark shadow-sm bg-opacity-75 backdrop-blur font-cairo">
              {{ m.age }} سنة
            </span>
          </div>
        </div>

        <div class="card-body p-4">
          <!-- Name & City -->
          <div class="mb-3">
            <h5 class="card-title fw-bold text-dark mb-1 font-cairo">{{ m.fullName }}</h5>
            <div class="text-muted small font-cairo">
              <i class="bi bi-geo-alt-fill text-primary me-1"></i> {{ m.city }}
            </div>
          </div>

          <hr class="border-light my-3" />

          <h6 class="fw-bold text-secondary text-uppercase small mb-3 font-cairo">
            تفاصيل التوافق
          </h6>

          <div class="d-flex flex-wrap gap-2">
            <!-- City -->
            <span class="match-tag" [class.matched]="m.breakdown?.cityMatch">
              <i class="bi" [ngClass]="m.breakdown?.cityMatch ? 'bi-check-circle-fill' : 'bi-x-circle-fill'"></i>
              المدينة
            </span>
            <!-- Budget -->
            <span class="match-tag" [class.matched]="m.breakdown?.budgetCompatible">
              <i class="bi" [ngClass]="m.breakdown?.budgetCompatible ? 'bi-wallet-fill' : 'bi-dash-circle'"></i>
              الميزانية
            </span>
            <!-- Smoking -->
            <span class="match-tag" [class.matched]="m.breakdown?.smokingCompatible">
              <i class="bi bi-wind"></i> التدخين
            </span>
            <!-- Pets -->
            <span class="match-tag" [class.matched]="m.breakdown?.petsCompatible">
              <i class="bi bi-gitlab"></i> حيوانات
            </span>
            <!-- Sleep -->
            <span class="match-tag" [class.matched]="m.breakdown?.sleepScheduleMatch">
              <i class="bi bi-moon-stars-fill"></i> النوم
            </span>
            <!-- Social -->
            <span class="match-tag" [class.matched]="m.breakdown?.socialLevelMatch">
              <i class="bi bi-people-fill"></i> اجتماعي
            </span>
          </div>

          <!-- Action Button -->
          <div class="mt-4">
            <button class="btn btn-primary w-100 rounded-pill py-2 fw-bold font-cairo shadow-sm hover-lift">
              <i class="bi bi-chat-dots me-2"></i> تواصل الآن
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 3. EMPTY STATE (Only shows if not loading AND no matches) -->
  <div *ngIf="!isLoading && matches.length === 0" class="text-center py-5">
    <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center mb-3"
         style="width: 100px; height: 100px">
      <i class="bi bi-search fs-1 text-muted"></i>
    </div>
    <h4 class="fw-bold text-muted font-cairo">لا توجد نتائج مطابقة</h4>
    <p class="text-secondary font-cairo">حاول توسيع نطاق البحث أو تغيير التفضيلات.</p>
  </div>

</div>